<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kakao Map with GeoJSON</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ffb46c6e52f67ba3c00997e78bc3590a"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        #map {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 0;
        }
        #controls .group {
            margin-bottom: 20px;
        }
        
        #controls .group h3 {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }        
        #controls {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background: #f9f9f9;
            border-left: 1px solid #ccc;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            padding: 10px;
            box-sizing: border-box;
            transition: right 0.3s ease;
            z-index: 1000;
        }
        #controls.open {
            right: 0;
        }
        #controls h2 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        #controls label {
            display: block;
            margin-bottom: 10px;
            padding: 5px;
            border-radius: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #controls label.checked {
            background-color: #007BFF;
            color: white;
        }
        #controls input[type="checkbox"] {
            margin-right: 10px;
        }
        #controls button {
            width: 100%;
            margin-bottom: 10px;
            padding: 10px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            border-radius: 5px;
        }
        #resetButton {
            background: #ff4d4d;
            color: white;
        }
        #labelToggleButton {
            background: #007BFF;
            color: white;
        }
        #labelToggleButton.active {
            background: #28a745;
        }
        #searchBox {
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        #searchResultCount {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        #toggleButton {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            width: 30px;
            height: 100px;
            background: #007BFF;
            color: white;
            text-align: center;
            line-height: 100px;
            cursor: pointer;
            border-radius: 5px 0 0 5px;
            z-index: 1001;
            font-size: 14px;
        }
    </style>
</head>
<body>
<body>
    <div id="map"></div>
    <div id="controls">
        <h2>쿠팡이츠 표준 권역 </h2>
        <input type="text" id="searchBox" placeholder="검색..." oninput="filterCheckboxes()">
        <div id="searchResultCount">검색 결과: 0개</div>
        <button id="resetButton" onclick="resetSelections()">선택 초기화</button>
        <button id="labelToggleButton" onclick="toggleLabels()">동이름 표시/숨기기</button>

        <div class="group">
            <h3>서울특별시</h3>
        <label>
            <input type="checkbox" id="서울시영등포data1" onchange="toggleData('서울시영등포data1', './영등포중앙_test1.geojson')">
            영등포구_영등포중앙
        </label>
        <label>
            <input type="checkbox" id="서울시서대문구data1" onchange="toggleData('서울시서대문구data1', './서대문구 북부4.geojson')">
            서대문구_서대문구북부
        </label>
        <label>
            <input type="checkbox" id="서울시서대문구data2" onchange="toggleData('서울시서대문구data2', './서대문구 서부.geojson')">
            서대문구_서대문구서부
        </label>
        <label>
            <input type="checkbox" id="서울시은평구data1" onchange="toggleData('서울시은평구data1', './은평구중앙 test1.geojson')">
            은평구_은평구중앙
        </label>
        <label>
            <input type="checkbox" id="서울시은평구data2" onchange="toggleData('서울시은평구data2', './은평구동부.geojson')">
            은평구_은평구동부
        </label>
        <label>
            <input type="checkbox" id="서울시강남구data1" onchange="toggleData('서울시강남구data1', './강남서부.geojson')">
            강남구_강남서부
        </label>
        <label>
            <input type="checkbox" id="서울시강남구data2" onchange="toggleData('서울시강남구data2', './강남남서부.geojson')">
            강남구_강남남서부
        </label>
        <label>
            <input type="checkbox" id="서울시강남구data3" onchange="toggleData('서울시강남구data3', './강남남부.geojson')">
            강남구_강남남부
        </label>
        <label>
            <input type="checkbox" id="서울시강남구data4" onchange="toggleData('서울시강남구data4', './강남중앙.geojson')">
            강남구_강남중앙
        </label>
        <label>
            <input type="checkbox" id="서울시서초구data1" onchange="toggleData('서울시서초구data1', './서초중앙.geojson')">
            서초구_서초중앙
        </label>
        <div class="group">
            <h3>경기도</h3>
        <label>
            <input type="checkbox" id="경기도시흥시1" onchange="toggleData('경기도시흥시1', './시흥시남부1.geojson')">
            시흥시_시흥시남부
        </label>
        <label>
            <input type="checkbox" id="경기도안산시1" onchange="toggleData('경기도안산시1', './안산시동부.geojson')">
            안산시_안산시동부
        </label>
        <label>
            <input type="checkbox" id="경기도하남시1" onchange="toggleData('경기도하남시1', './하남중앙1.geojson')">
            하남시_하남중앙
        </label>
        <label>
            <input type="checkbox" id="경기도화성시1" onchange="toggleData('경기도화성시1', './화성시 동탄북부2.geojson')">
            화성시_화성시 동탄북부
        </label>
        <label>
            <input type="checkbox" id="경기도화성시2" onchange="toggleData('경기도화성시2', './화성시 동탄중앙.geojson')">
            화성시_화성시 동탄중앙
        </label>
        <label>
            <input type="checkbox" id="경기도수원시1" onchange="toggleData('경기도수원시1', './수원 팔달구중앙3.geojson')">
            수원시_팔달구중앙
        </label>
        <label>
            <input type="checkbox" id="경기도수원시2" onchange="toggleData('경기도수원시2', './수원 장안구중앙1.geojson')">
            수원시_장안구중앙
        </label>
        <label>
            <input type="checkbox" id="경기도수원시3" onchange="toggleData('경기도수원시3', './수원 영통구중앙1.geojson')">
            수원시_영통구중앙
        </label>
        <label>
            <input type="checkbox" id="경기도수원시4" onchange="toggleData('경기도수원시4', './수원 권선구 중앙.geojson')">
            수원시_권선구중앙
        </label>
        <label>
            <input type="checkbox" id="경기도수원시5" onchange="toggleData('경기도수원시5', './수원 권선구 중앙2.geojson')">
            수원시_권선구중앙2
        </label>
        <label>
            <input type="checkbox" id="경기도수원시6" onchange="toggleData('경기도수원시6', './수원 영통구 동부.geojson')">
            수원시_영통구동부
        </label>
    </div>
    <div id="toggleButton">메뉴</div>
    <script>
        var map = new kakao.maps.Map(document.getElementById('map'), {
            center: new kakao.maps.LatLng(37.5665, 126.9780), // 서울 좌표
            level: 8
        });

        var polygons = {}; // 각 데이터의 다각형 객체 및 라벨 저장 객체
        var labelsVisible = true; // 라벨 표시 상태

        function toggleData(id, file) {
            var checkbox = document.getElementById(id);
            var label = checkbox.parentElement;
        
            if (checkbox.checked) {
                label.classList.add('checked');
                fetch(file)
                    .then(response => response.json())
                    .then(data => {
                        var features = data.features;
                        var polygonArray = [];
                        var bounds = new kakao.maps.LatLngBounds(); // 지도 이동용 경계 설정
        
                        features.forEach(feature => {
                            var coordinates = feature.geometry.coordinates;
                            var paths = [];
        
                            if (feature.geometry.type === "Polygon") {
                                paths.push(coordinates[0].map(coord => new kakao.maps.LatLng(coord[1], coord[0])));
                            } else if (feature.geometry.type === "MultiPolygon") {
                                coordinates.forEach(polygon => {
                                    paths.push(polygon[0].map(coord => new kakao.maps.LatLng(coord[1], coord[0])));
                                });
                            }
        
                            paths.forEach(path => {
                                var polygon = new kakao.maps.Polygon({
                                    map: map,
                                    path: path,
                                    strokeWeight: 2,
                                    strokeColor: '#FF0000',
                                    strokeOpacity: 0.8,
                                    fillColor: '#FFAAAA',
                                    fillOpacity: 0.7
                                });
        
                                // 폴리곤 경계 추가 (지도를 이동하기 위해)
                                path.forEach(coord => bounds.extend(coord));
        
                                var labelName = feature.properties.adm_dr_nm || feature.properties.ADM_DR_NM || "알 수 없음";
                                var center = getPolygonCenter(path);
                                var overlay = new kakao.maps.CustomOverlay({
                                    map: labelsVisible ? map : null,
                                    position: center,
                                    content: `
                                        <div style="font-size: 12px; font-weight: bold; color: black; 
                                            text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;">
                                            ${labelName}
                                        </div>`,
                                    yAnchor: 0
                                });
        
                                kakao.maps.event.addListener(polygon, 'mouseover', function() {
                                    polygon.setOptions({ fillColor: '#FF5555' });
                                    overlay.setContent(`
                                        <div style="font-size: 12px; font-weight: bold; color: red; 
                                            text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;">
                                            ${labelName}
                                        </div>`);
                                });
        
                                kakao.maps.event.addListener(polygon, 'mouseout', function() {
                                    polygon.setOptions({ fillColor: '#FFAAAA' });
                                    overlay.setContent(`
                                        <div style="font-size: 12px; font-weight: bold; color: black; 
                                            text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;">
                                            ${labelName}
                                        </div>`);
                                });
        
                                polygonArray.push({ polygon, overlay });
                            });
                        });
        
                        polygons[id] = polygonArray;
        
                        // 선택된 폴리곤으로 지도 이동
                        map.setBounds(bounds); // 폴리곤 영역으로 이동
                    })
                    .catch(error => console.error('Error loading GeoJSON:', error));
            } else {
                label.classList.remove('checked');
                if (polygons[id]) {
                    polygons[id].forEach(({ polygon, overlay }) => {
                        polygon.setMap(null);
                        overlay.setMap(null);
                    });
                    delete polygons[id];
                }
            }
        }

        function toggleLabels() {
            labelsVisible = !labelsVisible;
            Object.values(polygons).forEach(polygonArray => {
                polygonArray.forEach(({ overlay }) => {
                    overlay.setMap(labelsVisible ? map : null);
                });
            });

            var button = document.getElementById('labelToggleButton');
            if (labelsVisible) {
                button.classList.add('active');
                button.textContent = "동이름 숨기기";
            } else {
                button.classList.remove('active');
                button.textContent = "동이름 표시";
            }
        }

        function getPolygonCenter(path) {
            var sumLat = 0, sumLng = 0, len = path.length;
            path.forEach(coord => {
                sumLat += coord.getLat();
                sumLng += coord.getLng();
            });
            return new kakao.maps.LatLng(sumLat / len, sumLng / len);
        }

        function resetSelections() {
            var checkboxes = document.querySelectorAll('#controls input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    checkbox.checked = false;
                    toggleData(checkbox.id, '');
                }
            });
        }

        function filterCheckboxes() {
            var query = document.getElementById('searchBox').value.toLowerCase();
            var labels = document.querySelectorAll('#controls label');
            var count = 0;
            labels.forEach(label => {
                var text = label.innerText.toLowerCase();
                if (text.includes(query)) {
                    label.style.display = 'block';
                    count++;
                } else {
                    label.style.display = 'none';
                }
            });
            document.getElementById('searchResultCount').textContent = `검색 결과: ${count}개`;
        }
        

        document.getElementById('toggleButton').addEventListener('click', function() {
            var controls = document.getElementById('controls');
            controls.classList.toggle('open');
        });
    </script>
</body>
</html>
